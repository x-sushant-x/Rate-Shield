FROM golang:1.23-alpine

WORKDIR /app

COPY go.mod go.sum ./

RUN go mod download

COPY . .

RUN go build -o main .

ENV RATE_SHIELD_PORT=${RATE_SHIELD_PORT}

ENV REDIS_RULES_INSTANCE_URL=${REDIS_RULES_INSTANCE_URL}
ENV REDIS_RULES_INSTANCE_USERNAME=${REDIS_RULES_INSTANCE_USERNAME}
ENV REDIS_RULES_INSTANCE_PASSWORD=${REDIS_RULES_INSTANCE_PASSWORD}

ENV REDIS_CLUSTERS_URLS=${REDIS_CLUSTERS_URLS}
ENV REDIS_CLUSTER_USERNAME=${REDIS_CLUSTER_USERNAME}
ENV REDIS_CLUSTER_PASSWORD=${REDIS_CLUSTER_PASSWORD}

EXPOSE $RATE_SHIELD_PORT
CMD ["./main"]
